<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
</head>

<body>
  <form id="enter-boxID">
  <label for="box-id">Box ID:</label> <input id="box-id" type="text" placeholder="ID" />
  <input type="submit" value="Box it" />
  </form>

  <div id="tag">
  <p>Latest tag ID: <span id="tag-id"></span></p>
  <form id="attach-tag">
  <label for="spotify-uri">Spotify URI:</label> <input id="spotify-uri" type="text" placeholder="URI" />
  <input type="submit" value="Tag it" />
  </form>
  </div>
</body>

<script type="text/javascript">
  $(document).ready(function(){

    var latesttag;

    $("#tag").hide();

    $("#enter-boxID").submit(function() {
      $.get('box/' + $("#box-id").val(), function(data) {
        latesttag = data.latesttag;
        $("#tag").show('normal');
        $("#tag-id").text(latesttag);
        $.get('tag/' + latesttag, function(data) {
          if(data.content && data.content.type == 'spotify') {
            $("#spotify-uri").val(data.content.params.uri);
          }
        });
      });

      return false;
    });

    $("#attach-tag").submit(function() {
      $.post('tag', 
        {
          id: latesttag,
          content: { type:"spotify", params: {uri : $("#spotify-uri").val() } }      
        },
        function(data) {
          console.log(data);
        });
      return false;
    });

 });
</script>

</html>
